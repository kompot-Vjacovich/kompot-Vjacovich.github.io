<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <title>Рейтинг</title>

    <style>
        
    </style>
</head>
<body>
	<input type="file" id="files" onchange="readFile(this)">

    <div id="names">
        
    </div>


    <script>
    	function readFile(input) {
			let file = input.files[0];

			let reader = new FileReader();

			reader.readAsText(file);

			reader.onload = function() {
				let arr = reader.result.split(" ");
				for (var i = 0; i < student.length; i++) {
					student[i].score = parseInt(arr[i]);
				}

				addSelect();
				update();
				$('#files').remove();
			};

			reader.onerror = function() {
				console.log(reader.error);
			};
		}

		function addSelect() {
			$("#files").after('<select id="name"><option disabled selected>Выберите ученика</option><option>Богдан</option><option>Влад</option><option>Денис</option><option>Никита</option></select><input type="number" id="mark" min="-10" max="10"><input type="submit" id="send" onclick="addPoint()"><input type="button" value="Сохранить" id="save" onclick="save()">');
		}


        function update() {
        	$('#names').empty();
            for (let i = 0; i < student.length; i++) {
                $('#names').append("<h1>" + student[i].name + ' ' + student[i].score + "</h1>");
                //append score bar 
            }
            
        }

        function addPoint() {
            let Name = $('#name option:selected').text();
            let index = student.findIndex(s => s.name == Name);

            let point = $('#mark').val();
            student[index].score += parseInt(point);

            update();
            $('#mark').val('');
            $('select option:first').prop('selected', true);
        }

        function save() {
        	let csv = '';
        	for (var i = 0; i < student.length - 1; i++) {
        		csv += student[i].score + ' ';
        	}
        	csv += student[student.length - 1].score;
            let csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);
            
            window.open(csvData);
        }


        let student = [];
        for(let i = 0; i < 4; i++) student[i] = {};
        student[0].name = "Богдан";
        student[1].name = "Влад";
        student[2].name = "Денис";
        student[3].name = "Никита";

        student[0].score = 0;
        student[1].score = 0;
        student[2].score = 0;
        student[3].score = 0;

    </script>
</body>
</html>